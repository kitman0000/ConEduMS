<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
	<meta charset="utf-8" />
	<link rel="stylesheet" href="css/bootstrap.css">  
	<link rel="stylesheet" href="css/bootstrap.min.css">  
	<link rel="stylesheet" href="css/webStyle.css">  
	<link rel="stylesheet" href="css/bootstrap-datetimepicker.css">
	<link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css">
	
	<script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
	<script src="js/bootstrap-datetimepicker.js"></script>
	<script src="js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/bootstrap-datetimepicker.zh-CN.js"></script>
	
</head>
<body>
	<div class="page">
		
    	<!-- 标题 -->
        <nav class="navbar navbar-default" role="navigation" class="titlebar">
            <div class="container-fluid container" > 
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                        data-target="#example-navbar-collapse">
                    <span class="sr-only">切换导航</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">继续教育管理系统(管理端)</a>
            </div>
            <div class="collapse navbar-collapse" id="example-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li role="presentation"><a href="#">专业管理</a></li>
   					<li role="presentation"><a href="#">教学点管理</a></li>
					<li role="presentation"><a href="#">课程管理</a></li>
					<li role="presentation"  class="active"><a href="#">教师管理</a></li>
					<li role="presentation"><a href="#">学生管理</a></li>
					<li role="presentation"><a href="#">成绩管理</a></li>
					<li role="presentation"><a href="#">学生查询</a></li>
				</ul>  
            </div>
            </div>
        </nav>
        <!-- 标题结束 -->
						
		<!-- 内容开始 -->
		<div class="container">
			<!-- 导航开始 -->
			<div class="alert alert-info" role="alert">
				教师管理
			</div>
			<!-- 导航结束 -->
			<!--教学班列表-->
			<div class="listAdd" align="right">
				<button id="addItem"  data-toggle="modal" data-target="#addModal" class="btn btn-primary">添加</button>
			</div>
			<div class="bs-example" data-example-id="simple-table">
				<table class="table" id="ClassList">
					<thead class="row">
						<th teacher="col-sm-2 col-xs-2 ">
							教师编号
						</th>
						<th teacher="col-sm-2 col-xs-2 ">
							姓名
						</th>
						<th teacher="col-sm-2 col-xs-2 ">
							所属专业
						</th>
						<th teacher="col-sm-2 col-xs-2 ">
							性别
						</th>
						<th teacher="col-sm-2 col-xs-2 ">
							出身年月日
						</th>
						<th teacher="col-sm-2 col-xs-2 ">
							证件号码
						</th>
						<th teacher="col-sm-2 col-xs-2 ">
							
						</th>
					</thead>
					<tbody id="classListBody">
						
					</tbody>
				</table>
				<!-- 分页开始 -->
				<div style="width: 100%;" align="center">
					<ul class="pagination" id="pageDevider" style="margin-top: 10%;">
						
					</ul>
				</div>
				<!-- 分页结束 -->
			</div>
			<!--教学班列表结束-->

		</div>
		
		<!-- 内容结束 -->
	</div>
	
	<!-- 增加模态框 -->
	<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="width: 50%;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
						添加教师
					</h4>
				</div>
				<div class="modal-body" style="text-align: left; padding-left: 15%;" align="center">
					<div class="form-group form-inline">
						<label for="basic-url" style="margin-right: 3%;">教师编号:</label>
						<div class="input-group">
							<input type="text" class="form-control" id="addTeacherrID" aria-describedby="basic-addon3">
						</div>
						<label for="basic-url"style="margin-right: 5.5%;">姓名:</label>
						<div class="input-group">
							<input type="text" class="form-control" id="addTeacherName" aria-describedby="basic-addon3">
						</div>
					</div>
					
					<div class="form-group form-inline">
						<label for="basic-url" style="margin-right: 3%;">所属专业:</label>
						<div class="input-group">
							<input type="text" class="form-control" id="addMajorID" aria-describedby="basic-addon3">
						</div>
						<label for="basic-url"style="margin-right: 5.5%;">性别:</label>
						<div class="input-group">
							<input type="text" class="form-control" id="addTeacherGender" aria-describedby="basic-addon3">
						</div>
					</div>
					
					<div class="form-group form-inline">
						
						<label for="basic-url" style="margin-right: 1.2%;">出生年月日:</label>
						<div class="input-group date form_date col-md-4" style="width: 22.7%;" data-date="" data-date-format="yyyy年mm月dd日" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
							<input class="form-control" id="addTeacherBirthDate" size="16" type="text" value="" readonly="readonly" style="background: #fff;">
							<span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
						</div>
						<label for="basic-url" style="margin-right: 1.9%;">证件号码:</label>
						<div class="input-group">
							<input type="text" class="form-control" id="addTeacherSocialID" aria-describedby="basic-addon3">
						</div>
					</div>
				</div>
				<div class="modal-footer">
								
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭
					</button>
					<button type="button" class="btn btn-primary" id="addClass">
						确定
					</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal -->
	</div>
	<!-- 结束增加模态框 -->
	
	<!-- 删除警告模态框 -->
	<div class="modal fade" id="DeleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="width: 10%;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
						警告
					</h4>
				</div>
				<div class="modal-body" style="text-align: left;">
					确认要删除此班级？
				</div>
				<div class="modal-footer" style=" 	width: 100%;display: table; text-align: center;">
					
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭
					</button>
					<button type="button" id="confirmDelete" class="btn btn-danger" data-dismiss="modal">
						删除
					</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal -->
	</div>
	<!-- 结束删除警告模态框 -->
	
			
	<!-- 修改模态框 -->
	<div class="modal fade" id="ChangeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="width: 50%;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
						修改班级
					</h4>
				</div>
				<div class="modal-body" style="text-align: left;padding-left: 25%;">

					<div class="form-group form-inline">
						<label for="basic-url" style="margin-right: 3%;">教师编号:</label>
						<div class="input-group">
							<input type="text" teacher="form-control" id="editTeacherID" aria-describedby="basic-addon3" readonly="readonly">
						</div>
						<label for="basic-url" style="margin-right: 4.3%;">姓名:</label>
						<div class="input-group">
							<input type="text" class="form-control" id="editTeacherName" aria-describedby="basic-addon3">
						</div>
					</div>
					
					<div class="form-group form-inline">
						<label for="basic-url" style="margin-right: 3%;">所属专业:</label>
						<div class="input-group">
							<input type="text" class="form-control" id="editMajorID" aria-describedby="basic-addon3">
						</div>
						
						<label for="basic-url" style="margin-right: 2.4%;">性别:</label>
						<div class="input-group">
							<input type="text" class="form-control" id="editTeacherGender" aria-describedby="basic-addon3">
						</div>
					</div>
					
					<div class="form-group form-inline">
						<label for="basic-url" style="margin-right: 0.5%;">出生年月日:</label>
						<div class="input-group date form_date col-md-4" style="width: 24%;" data-date="" data-date-format="yyyy年mm月dd日" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
							<input class="form-control" id="editStartDate" size="16" type="text" value="" readonly="readonly" style="background: #fff;">
							<span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
						</div>
						<label for="basic-url" style="margin-right: 1%;">证件号码:</label>
						<div class="input-group">
							<input type="text" class="form-control" id="editCounselorTel" aria-describedby="basic-addon3">
						</div>
					</div>
				</div>
				<div class="modal-footer">
					
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭
					</button>
					<button type="button" class="btn btn-primary" id="editClass">
						提交更改
					</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal -->
	</div>
	<!-- 结束修改模态框 -->
	
	<!-- 警告信息模态框 -->
	<div class="modal fade" id="warningInfoModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="width: 40%;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
						警告
					</h4>
				</div>
				<div class="modal-body" style="text-align: center;">
					<span id="warningInfo"></span>
				</div>
				<div class="modal-footer" style="width: 100%;display: table; text-align: center;">
					
					<button type="button" class="btn btn-default" data-dismiss="modal">确定
					</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal -->
	</div>
	<!-- 结束删除警告模态框 -->
</body>

<script>
var obj;

$(function(){
	$.ajax({
		type: "POST",
		url: "TeacherManage.aspx/getAllTeacheres",
		datatype: "json",
		contentType: "application/json;charset=utf-8",
		data:
		{
			
		},
		success:
			function (data, textStatus) {
				showClasses(data.d);
			},
	});
	
	$("#addTeacher").click(function(){
		//warningInfo
		if($("#addTeacherID").val().length !=6)
		{
			$("#warningInfo").html("教师编号为6位 ");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		if($("#addTeacherName").val().length !=30)
		{
			$("#warningInfo").html("教师姓名为4位");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		if($("#addMajorID").val().length !=4)
		{
			$("#warningInfo").html("该教师所属专业的编号为4位");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		if($("#addTeacherGender").val().length !=1)
		{
			$("#warningInfo").html("教师性别为1位");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		if($("#addTeacherBrithData").val().length ==0)
		{
			$("#warningInfo").html("教师出生日期，例如：19800125");
			$("#warningInfoModal").modal("show");
			return;
		}

		if($("#addTeacherSocialID").val().length ==18)
		{
			$("#warningInfo").html("教师身份证号。若为外籍教师则为护照号，在护照号的前面补0，使其构成18位。");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		for(i = 0;i<obj.length;i++)
		{
			if(obj[i].teacherID == $("#addTeacherID").val())
			{
				$("#warningInfo").html("该教师ID已经被占用");
				$("#warningInfoModal").modal("show");
				return;
			}
		}

		$("#addModal").modal("hide");
		
		$.ajax({
			type: "POST",
			url: "TeacherManage.aspx/addTeacher",
			datatype: "json",
			contentType: "application/json;charset=utf-8",
			data:
				"{"+
				"'teacherID':'" + $("#addTeacherID").val()+"',"+
				"'teacherName':'" + $("#addTeacherName").val()+"',"+
				"'majorID':'" + $("#addMajorID").val()+"',"+
				"'teacherGender':'" + $("#addTeacherGender").val()+"',"+
				"'teacherBirthData':'" + $("#addTeacherBirthData").val()+"',"+
				"'teacherSocialID':'" + $("#addTeacherSocialID").val()+"',"+
				+"}"
			,
			success:
				function (data, textStatus) {
					setCookie("add",1);
					location.reload();
				},
		});
	});
	
	$("#confirmDelete").click(function(){
		$.ajax({
			type: "POST",
			url: "TeacherManage.aspx/delTeacher",
			datatype: "json",
			contentType: "application/json;charset=utf-8",
			data:
				"{"+
				"'teacherID':'" + delTeacherID +"'"+
				"}"
			,
			success:
				function (data, textStatus) {
					if(data.d == "success")
					{
						deleteSuccess();
					}
				},
		});
	});
	
	$("#editTeacher").click(function(){
		
		if($("#editTeacherID").val().length !=6)
		{
			$("#warningInfo").html("教师编号为6位");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		if($("#editTeacherName").val().length !=30)
		{
			$("#warningInfo").html("教师姓名为30位");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		if($("#editMajorID").val().length !=4)
		{
			$("#warningInfo").html("该教师所属专业的编号为4位");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		if($("#editTeacherGender").val().length !=1)
		{
			$("#warningInfo").html("教师性别为1位");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		if($("#editTeacherBirthData").val().length ==0)
		{
			$("#warningInfo").html("教师出生年月日，例如：19800125");
			$("#warningInfoModal").modal("show");
			return;
		}

		if($("#editTeacherSocialID").val().length =18)
		{
			$("#warningInfo").html("教师身份证号。若为外籍教师则为护照号，在护照号的前面补0，使其构成18位。");
			$("#warningInfoModal").modal("show");
			return;
		}

		$("#ChangeModal").modal("hide");
		
		$.ajax({
			type: "POST",
			url: "TeacherManage.aspx/editTeacher",
			datatype: "json",
			contentType: "application/json;charset=utf-8",
			data:
				"{"+
				"'teacherID':'" + $("#editTeacherID").val()+"',"+
				"'teacherName':'" + $("#editTeacherName").val()+"',"+
				"'majorID':'" + $("#editMajorID").val()+"',"+
				"'teacherGender':'" + $("#editTeacherGender").val()+"',"+
				"'teacherBirthData':'" + $("#editTeacherBirthData").val()+"',"+
				"'teacherSocialID':'" + $("#editTeacherSocialID").val()+"',"+

				+"}"
			,
			success:
				function (data, textStatus) {
					if(data.d == "success")
					{
						editSuccess();
					}
				},
		});
	});
});
	
function showClasses(data)
{
	obj = JSON.parse(data);
	_data = data;
	for(i=0;i<obj.length&&i<5;i++)
	{
		try{
			insert = "<tr><th>"+
			obj[i].teacherID+
			"</th><th"+obj[i].teacherID+">"+
			obj[i].teacherName+
			"</th><th"+obj[i].teacherID+">"+
			obj[i].majorID+
			"</th><th"+obj[i].teacherID+">"+
			obj[i].teacherGender+
			"</th><th"+obj[i].teacherID+">"+
			obj[i].teacherBirthData+
			"</th><th"+obj[i].teacherID+">"+
			obj[i].teacherSocialID+
			"</th><th"+obj[i].teacherID+">"+
			obj[i].endDate+
			"</th><th>"+
			"<button type=\"button\"  data-toggle=\"modal\" data-target=\"#ChangeModal\" class=\"btn btn-primary btn-xs ClassListButton\" onclick=\"edit(\'" + obj[i].classID + "\')\">修改</button>"+
			"<button type=\"button\" class=\"btn btn-danger ClassListButton  btn-xs \" data-toggle=\"modal\" data-target=\"#DeleteModal\"  onclick=\"del(\'" + obj[i].classID + "\')\">删除</button>"+
			"</th></tr>";
			$("#teacherListBody").append(insert);
		}
		catch(err){}
		
	}
	$("#pageDevider").append("<li><a onclick=\"prePage()\" href=\"#\">&laquo;</a></li>")
	for(i=1;i<obj.length/5;i++)
	{
		$("#pageDevider").append("<li><a onclick=\"switchPage("	+i+")\" href=\"#\">"+i+"</a></li>");
	}
	$("#pageDevider").append("<li><a onclick=\"switchPage("+i+")\" href=\"#\">"+i+"</a></li>");
	$("#pageDevider").append("<li><a onclick=\"nextPage()\" href=\"#\">&raquo;</a></li>")
	nowPage = 1;
	if(getCookie("add")==1)
	{
		page = Math.floor(obj.length / 5);
		if(obj.length % 5 != 0)
		{
			page++;
		}
		switchPage(page);
		setCookie("add",0);
	}
	if(getCookie("delete")!=0)
	{
		switchPage(getCookie("delete"));
		setCookie("delete",0);
	}
	
	$('.form_date').datetimepicker({
		language:  'zh-CN',
		weekStart: 1,
		todayBtn:  1,
		autoclose: 1,
		todayHighlight: 1,
		startView: 2,
		minView: 2,
		forceParse: 0
	});
}



function deleteSuccess()
{
	setCookie("delete",nowPage);
	location.reload();
}

function editSuccess()
{
	for(i = 0;i<obj.length;i++)
	{
		if(obj[i].teacherID == $("#editTeacherID").val())
		{
			obj[i].teacherName = $("#editTeacherName").val();
			obj[i].MajorID = $("#editMajorID").val();
			obj[i].teacherGender = $("#editTeacherGender").val();
			obj[i].teacherBirthData = $("#editTeacherBirthData").val();
			obj[i].teacherSocialID = $("#editTeacherSocialID").val();
			switchPage(nowPage);
		}
	}
}

function switchPage(num)
{
	nowPage = num;
	$("#classListBody").html("");
	//obj = JSON.parse(_data);
	s=0;
	console.log(num);
	for(i=(num-1)*5;i<obj.length&&s<5;i++)
	{
		try{
			insert = "<tr><th>"+
			obj[i].teacherID+
			"</th><th"+obj[i].teacherID+">"+
			obj[i].teacherName+
			"</th><th"+obj[i].teacherID+">"+
			obj[i].majorID+
			"</th><th"+obj[i].teacherID+">"+
			obj[i].teacherGender+
			"</th><th"+obj[i].teacherID+">"+
			obj[i].teacherBirthData+
			"</th><th"+obj[i].teacherID+">"+
			obj[i].teacherSocialID+
			"</th><th>"+
			"<button type=\"button\"  data-toggle=\"modal\" data-target=\"#ChangeModal\" class=\"btn btn-primary btn-xs ClassListButton\" onclick=\"edit(\'" + obj[i].classID + "\')\">修改</button>"+
			"<button type=\"button\" class=\"btn btn-danger ClassListButton  btn-xs \" data-toggle=\"modal\" data-target=\"#DeleteModal\"  onclick=\"del(\'" + obj[i].classID + "\')\">删除</button>"+
			"</th></tr>";
			$("#teacherListBody").append(insert);
		}
		catch(err){}
		s++;
	}
}

function edit(id)
{
	console.log(id);
	for(i = 0;i<obj.length;i++)
	{
		if(obj[i].teacherID == id)
		{
			$("#editTeacherID").val(obj[i].teacherID);
			$("#editTeacherName").val(obj[i].teacherName);
			$("#editMajorID").val(obj[i].majorID);
			$("#editTeacherGender").val(obj[i].teachergender);
			$("#editTeacherBirthData").val(obj[i].teacherBirthData);
			$("#editTeacherSocialID").val(obj[i].teacherSocialID);
			break;
		}
	}
}

function del(id)
{
	delTeacherID = id;
}

function prePage()
{
	if(nowPage!=1)
	{
		switchPage(nowPage - 1);
	}
}

function nextPage()
{
	obj = JSON.parse(_data);
	if(nowPage!=obj.length/5 + 1)
	{
		switchPage(nowPage + 1);
	}
}

function getCookie(cname)
{
  var name = cname + "=";
  var ca = document.cookie.split(';');
  for(var i=0; i<ca.length; i++) 
  {
    var c = ca[i].trim();
    if (c.indexOf(name)==0) return c.substring(name.length,c.length);
  }
  return "";
}

function setCookie(name,value)
{
     document.cookie = name + "=" + value + "; ";
} 
</script>
</html>
