<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta charset="utf-8" />
		
		<link rel="stylesheet" href="css/bootstrap.min.css">
		<link rel="stylesheet" href="css/webStyle.css">
		<link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css">

		<script src="js/System.js"></script>
		<script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/bootstrap-datetimepicker.zh-CN.js"></script>

	</head>
	<body>
		<div class="page">

			<!-- 标题 -->
			<nav class="navbar navbar-default" role="navigation" class="titlebar">
				<div class="container-fluid container">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#example-navbar-collapse">
							<span class="sr-only">切换导航</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="#">继续教育管理系统(管理端)</a>
					</div>
					<div class="collapse navbar-collapse" id="example-navbar-collapse">
						<ul class="nav navbar-nav" id="navbar">
							<li role="presentation"><a href="MajorManage.html">专业管理</a></li>
							<li role="presentation"><a href="#">教学点管理</a></li>
							<li role="presentation"><a href="#">课程管理</a></li>
							<li role="presentation"><a href="#">教师管理</a></li>
							<li role="presentation"><a href="#">教学班管理</a></li>
							<li role="presentation"><a href="#">学生管理</a></li>
							<li role="presentation"><a href="#">成绩管理</a></li>
							<li role="presentation"><a href="#">学生查询</a></li>
						</ul>
					</div>
				</div>
			</nav>
			<!-- 标题结束 -->

			<!-- 内容开始 -->
			<div class="container">
				<!-- 导航开始 -->
				<div class="alert alert-info" role="alert">
					教学班
				</div>
				<!-- 导航结束 -->
				<!--教学班列表-->
				<div class="listAdd" align="right">
					<button id="addItem" data-toggle="modal" data-target="#addModal" class="btn btn-primary">添加</button>
				</div>
				<div class="bs-example" data-example-id="simple-table">
					<table class="table" id="ClassList">
						<thead class="row">
							<th class="col-sm-2 col-xs-2 ">
								管理员编号
							</th>
							<th class="col-sm-1 col-xs-1 ">
								姓名
							</th>
							<th class="col-sm-1 col-xs-1 ">
								性别
							</th>
							<th class="col-sm-1 col-xs-1 ">
								出生日期
							</th>
							<th class="col-sm-2 col-xs-2 ">
								身份证号
							</th>
							<th class="col-sm-1 col-xs-1 ">
								电话号码
							</th>
							<th class="col-sm-2 col-xs-2 ">
								通讯地址
							</th>
							<th class="col-sm-2 col-xs-2 ">
								管理教学点编号
							</th>
							<th class="col-sm-2 col-xs-2 ">

							</th>
						</thead>
						<tbody id="classListBody">

						</tbody>
					</table>
					<!-- 分页开始 -->
					<div style="width: 100%;" align="center">
						<ul class="pagination" id="pageDevider" style="margin-top: 10%;">

						</ul>
					</div>
					<!-- 分页结束 -->
				</div>
				<!--教学班列表结束-->

			</div>

			<!-- 内容结束 -->
		</div>

		<div class="container">
			<!-- 增加模态框 -->
			<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog" style="width: 50%;">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
								&times;
							</button>
							<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
								添加管理员
							</h4>
						</div>
						<div class="modal-body">	
						<table align="center">
							<tbody>

								<tr>
									<td class="listItem" style="width: 100px;">
										<label for="addAdminID" style="margin-right: 3px;">管理员编号:</label>
									</td>
									<td class="listItem" >
										<input type="text" class="form-control" id="addAdminID" aria-describedby="basic-addon3">
									</td>

									<td class="listItem" style="width: 100px;">
										<label for="addAdminName" style="margin-right: 3px;">姓名:</label>
									</td>
									<td class="listItem">
										<input type="text" class="form-control" id="addAdminName" aria-describedby="basic-addon3">
									</td>
								</tr>

								<tr>
									<td class="listItem">
										<label for="addAdminGender" style="margin-right: 3px;">性别:</label>
									</td>
									<td class="listItem">
										<input type="text" class="form-control" id="addAdminGender" aria-describedby="basic-addon3">
									</td>
									<td class="listItem">
										<label for="addAdminBirthDate" style="marAgin-right: 0.5%;">出生日期:</label>
									</td>
									<td class="listItem">
										<div class="input-group date form_date col-md-4" style="width: 100%;" data-date="" data-date-format="yyyy年mm月dd日"
										data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
											<input class="form-control" id="addAdminBirthDate" size="16" type="text" value="" readonly="readonly" style="background: #fff;">
											<span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
										</div>
									</td>
								</tr>
								<tr>
									<td class="listItem">
										<label for="addAdminSocialID" style="margin-right: 3px;">身份证号:</label>
									</td>
									<td class="listItem">
										<input type="text" class="form-control" id="addAdminSocialID" aria-describedby="basic-addon3">
									</td>
								
									<td class="listItem">
										<label for="addAdminTel" style="margin-right: 3px;">电话号码:</label>
									</td>
									<td class="listItem">
										<input type="text" class="form-control" id="addAdminTel" aria-describedby="basic-addon3">
									</td>
								</tr>
								<tr>
									<td class="listItem">
										<label for="addAdminAddress" style="margin-right: 3px;">通讯地址:</label>
									</td>
									<td class="listItem">
										<input type="text" class="form-control" id="addAdminAddress" aria-describedby="basic-addon3">
									</td>
								
									<td class="listItem">
										<label for="addAdminRight" style="margin-right: 3px;">:管理教学点编号</label>
									</td>
									<td class="listItem">
										<input type="text" class="form-control" id="addAdminRight" aria-describedby="basic-addon3">
									</td>
								</tr>
							</tbody>
						</table>
					</div>	
						
						<div class="modal-footer">

							<button type="button" class="btn btn-default" data-dismiss="modal">关闭
							</button>
							<button type="button" class="btn btn-primary" id="addAdministrator">
								确定
							</button>
						</div>
					</div>	
				</div><!-- /.modal-content -->
			</div><!-- /.modal -->
		</div>
		<!-- 结束增加模态框 -->

		<!-- 删除警告模态框 -->
		<div class="modal fade" id="DeleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog" style="width: 10%;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
							警告
						</h4>
					</div>
					<div class="modal-body" style="text-align: left;">
						确认要删除此班级？
					</div>
					<div class="modal-footer" style=" 	width: 100%;display: table; text-align: center;">

						<button type="button" class="btn btn-default" data-dismiss="modal">关闭
						</button>
						<button type="button" id="confirmDelete" class="btn btn-danger" data-dismiss="modal">
							删除
						</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal -->
		</div>
		<!-- 结束删除警告模态框 -->


		<!-- 修改模态框 -->
		<div class="modal fade" id="ChangeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog" style="width: 50%;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
							修改班级
						</h4>
					</div>
					<div class="modal-body">
					<table align="center">
						<tbody>
							<tr>
								<td class="listItem" style="width: 100px;">
									<label for="editAdminID" style="margin-right: 3%;">管理员编号:</label>
								</td>
								<td class="listItem">
									<input type="text" class="form-control" id="editAdminID" aria-describedby="basic-addon3" readonly="readonly">
								</td>
								<td class="listItem" style="width: 100px;">
									<label for="editAdminName" style="margin-right: 4.3%;">姓名:</label>
								</td>
								<td class="listItem">
									<input type="text" class="form-control" id="editAdminName" aria-describedby="basic-addon3">
								</td>
							</tr>

							<tr>
								<td class="listItem">
									<label for="editAdminGender" style="margin-right: 3%;">性别:</label>
								</td>
								<td class="listItem">
									<input type="text" class="form-control" id="editAdminGender" aria-describedby="basic-addon3">
								</td>
								<td class="listItem">
									<label for="editAdminBirthDate" style="margin-right: 0.5%;">出生日期:</label>
								</td>
								<td class="listItem">
									<div class="input-group date form_date col-md-4" style="width: 100%;" data-date="" data-date-format="yyyy年mm月dd日"
									data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
										<input class="form-control" id="editAdminBirthDate" size="16" type="text" value="" readonly="readonly" style="background: #fff;">
										<span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
									</div>
								</td>
								
							</tr>
							
								
							
							<tr>
								<td class="listItem">
									<label for="editAdminSocialID" style="margin-right: 2.4%;">身份证号:</label>
								</td>
								<td class="listItem">
									<input type="text" class="form-control" id="editAdminSocialID" aria-describedby="basic-addon3">
								</td>
								<td class="listItem">
									<label for="editAdminTel" style="margin-right: 2.4%;">电话号码:</label>
								</td>
								<td class="listItem">
									<input type="text" class="form-control" id="editAdminTel" aria-describedby="basic-addon3">
								</td>
							</tr>
							
							<tr>
							<td class="listItem">
								<label for="editAdminAddress" style="margin-right: 2.4%;">通讯地址:</label>
							</td>
							<td class="listItem">
								<input type="text" class="form-control" id="editAdminAddress" aria-describedby="basic-addon3">
							</td>
							<td class="listItem">
								<label for="editAdminRight" style="margin-right: 2.4%;">管理教学点编号:</label>
							</td>
							<td class="listItem">
								<input type="text" class="form-control" id="editAdminRight" aria-describedby="basic-addon3">
							</td>
						</tr>
						</tbody>
					</table>
				</div>		
					<div class="modal-footer">

						<button type="button" class="btn btn-default" data-dismiss="modal">关闭
						</button>
						<button type="button" class="btn btn-primary" id="editAdministrator">
							提交更改
						</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal -->
		</div>
		<!-- 结束修改模态框 -->

		<!-- 警告信息模态框 -->
		<div class="modal fade" id="warningInfoModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog" style="width: 40%;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
							警告
						</h4>
					</div>
					<div class="modal-body" style="text-align: center;">
						<span id="warningInfo"></span>
					</div>
					<div class="modal-footer" style="width: 100%;display: table; text-align: center;">

						<button type="button" class="btn btn-default" data-dismiss="modal">确定
						</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal -->
		</div>
		<!-- 结束删除警告模态框 -->
		</div>
	</body>

	<script>
		var obj;

		$(function() {
			$("#navbar").html(getNavbar());
			$("#AdministratorManage").addAdministrator("active");

			$.ajax({
				type: "POST",
				url: "AdministratorManage.aspx/getAllAdministrators",
				datatype: "json",
				contentType: "application/json;charset=utf-8",
				data: {

				},
				success: function(data, textStatus) {
					showAdministrators(data.d);
				},
			});

			$("#addAdministrator").click(function() {
				//warningInfo
				if ($("#addAdminID").val().length != 6) {
					$("#warningInfo").html("管理员编号为6位");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#addAdminName").val().length >30 || $("#addAdminName").val().length==0) {
					$("#warningInfo").html("管理员姓名");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#addAdminGender").val().length != 1) {
					$("#warningInfo").html("管理员性别（男或女）");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#addAdminBirthDate").val().length  == 0) {
					$("#warningInfo").html("管理员出生年月");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#addAdminSocialID").val().length !=18) {
					$("#warningInfo").html("管理员身份证号");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#addAdminTel").val().length >30 || $("#addAdminTel").val().length==0) {
					$("#warningInfo").html("管理员电话号码");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#addAdminAddress").val().length >=50 || $("#addAdminAddress").val().length==0) {
					$("#warningInfo").html("管理员通讯（住）地址");
					$("#warningInfoModal").modal("show");
					return;
				}
				
				if ($("#addAdminRight").val().length !=4) {
					$("#warningInfo").html("该管理员所管理的教学点编号。其中学院级管理权限为“9999”");
					$("#warningInfoModal").modal("show");
					return;
				}
				


				for (i = 0; i < obj.length; i++) {
					if (obj[i].addAdminIDID == $("#addAdminID").val()) {
						$("#warningInfo").html("该管理员ID已经被占用");
						$("#warningInfoModal").modal("show");
						return;
					}
				}

				$("#addModal").modal("hide");

				$.ajax({
					type: "POST",
					url: "AdministratorManage.aspx/addAdministrator",
					datatype: "json",
					contentType: "application/json;charset=utf-8",
					data: "{" +
						"'adminID':'" + $("#addAdminID").val() + "'," +
						"'adminName':'" + $("#addAdminName").val() + "'," +
						"'adminGender':'" + $("#addAdminGender").val() + "'," +
						"'adminBirthDate':'" + $("#addAdminBirthDate").val() + "'," +
						"'adminSocialID':'" + $("#addAdminSocialID").val() + "'," +
						"'adminTel':'" + $("#addAdminTel").val() + "'," +
						"'adminAddress':'" + $("#addAdminAddress").val() + "'," +
						"'adminRight':'" + $("#addAdminRight").val() + "'" +
						"}",
					success: function(data, textStatus) {
						setCookie("add", 1);
						location.reload();
					},
				});
			});

			$("#confirmDelete").click(function() {
				$.ajax({
					type: "POST",
					url: "AdministratorManage.aspx/delAdministrator",
					datatype: "json",
					contentType: "application/json;charset=utf-8",
					data: "{" +
						"'adminID':'" + delAdminID + "'" +
						"}",
					success: function(data, textStatus) {
						if (data.d == "success") {
							deleteSuccess();
						}
					},
				});
			});

			$("#editAdministrator").click(function() {

				if ($("#editAdminID").val().length != 6) {
					$("#warningInfo").html("管理员编号为6位");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#editAdminName").val().length >30 ||$("#editAdminName").val().length==0) {
					$("#warningInfo").html("管理员姓名");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#editAdminGender").val().length != 1) {
					$("#warningInfo").html("管理员性别（男或女）");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#editAdminBirthDate").val().length== 0) {
					$("#warningInfo").html("管理员出生年月");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#editAdminSocialID").val().length != 18) {
					$("#warningInfo").html("管理员身份证号");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#editAdminTel").val().length >30 || $("#editAdminTel").val().length==0) {
					$("#warningInfo").html("管理员电话号码");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#editAdminAddress").val().length >50 ||$("#editAdminAddress").val().length==0) {
					$("#warningInfo").html("管理员通讯（住）地址");
					$("#warningInfoModal").modal("show");
					return;
				}
				
				if ($("#editAdminRight").val().length !=4) {
					$("#warningInfo").html("该管理员所管理的教学点编号。其中学院级管理权限为“9999”");
					$("#warningInfoModal").modal("show");
					return;
				}

				


				$("#ChangeModal").modal("hide");

				$.ajax({
					type: "POST",
					url: "AdministratorManage.aspx/editAdministrator",
					datatype: "json",
					contentType: "application/json;charset=utf-8",
					data: "{" +
						"'adminID':'" + $("#editAdminID").val() + "'," +
						"'adminName':'" + $("#editAdminName").val() + "'," +
						"'adminGender':'" + $("#editAdminGender").val() + "'," +
						"'adminBirthDate':'" + $("#editAdminBirthDate").val() + "'," +
						"'adminSocialID':'" + $("#editAdminSocialID").val() + "'," +
						"'adminTel':'" + $("#editAdminTel").val() + "'," +
						"'adminAddress':'" + $("#editAdminAddress").val() + "'," +
						"'adminRight':'" + $("#editAdminRight").val() + "'" +
						"}",
					success: function(data, textStatus) {
						if (data.d == "success") {
							editSuccess();
						}
					},
				});
			});
		});

		function showAdministrators(data) {
			obj = JSON.parse(data);
			_data = data;
			for (i = 0; i < obj.length && i < 5; i++) {
				try {
					insert = "<tr><td>" +
						obj[i].adminID +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminName +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminGender +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminBirthDate +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminSocialID +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminTel +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminAddress +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminRight +
						"</td><td>" +
						"<button type=\"button\"  data-toggle=\"modal\" data-target=\"#ChangeModal\" administrator=\"btn btn-primary btn-xs ListOperButton\" onclick=\"edit(\'" +
						obj[i].adminID + "\')\">修改</button>" +
						"<button type=\"button\" administrator=\"btn btn-danger ListOperButton  btn-xs \" data-toggle=\"modal\" data-target=\"#DeleteModal\"  onclick=\"del(\'" +
						obj[i].adminID + "\')\">删除</button>" +
						"</td></tr>";
					$("#administratorListBody").append(insert);
				} catch (err) {}

			}
			$("#pageDevider").append("<li><a onclick=\"prePage()\" href=\"#\">&laquo;</a></li>")
			for (i = 1; i < obj.length / 5; i++) {
				$("#pageDevider").append("<li><a onclick=\"switchPage(" + i + ")\" href=\"#\">" + i + "</a></li>");
			}
			$("#pageDevider").append("<li><a onclick=\"switchPage(" + i + ")\" href=\"#\">" + i + "</a></li>");
			$("#pageDevider").append("<li><a onclick=\"nextPage()\" href=\"#\">&raquo;</a></li>")
			nowPage = 1;
			if (getCookie("add") == 1) {
				page = Math.floor(obj.length / 5);
				if (obj.length % 5 != 0) {
					page++;
				}
				switchPage(page);
				setCookie("add", 0);
			}
			if (getCookie("delete") != 0) {
				switchPage(getCookie("delete"));
				setCookie("delete", 0);
			}

			$('.form_date').datetimepicker({
				language: 'zh-CN',
				weekStart: 1,
				todayBtn: 1,
				autoclose: 1,
				todayHighlight: 1,
				startView: 2,
				minView: 2,
				forceParse: 0
			});
		}

		function deleteSuccess() {
			setCookie("delete", nowPage);
			location.reload();
		}

		function editSuccess() {
			for (i = 0; i < obj.length; i++) {
				if (obj[i].adminID == $("#editAdminID").val()) {
					obj[i].adminName = $("#editAdminName").val();
					obj[i].adminGender = $("#editAdminGender").val();
					obj[i].adminBirthDate = $("#editAdminBirthDate").val();
					obj[i].adminSocialID = $("#editAdminSocialID").val();
					obj[i].adminTel = $("#editAdminTel").val();
					obj[i].adminAddress = $("#editAdminAddress").val();
					obj[i].adminRight = $("#editAdminRight").val();
					switchPage(nowPage);
				}
			}
		}

		function switchPage(num) {
			nowPage = num;
			$("#administratorListBody").html("");
			//obj = JSON.parse(_data);
			s = 0;
			console.log(num);
			for (i = (num - 1) * 5; i < obj.length && s < 5; i++) {
				try {
					insert = "<tr><td>" +
						obj[i].adminID +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminName +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminGender +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminBirthDate +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminSocialID +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminTel +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminAddress +
						"</td><td " + obj[i].adminID + ">" +
						obj[i].adminRight +
						
						"</td><td>" +
						"<button type=\"button\"  data-toggle=\"modal\" data-target=\"#ChangeModal\" administrator=\"btn btn-primary btn-xs ListOperButton\" onclick=\"edit(\'" +
						obj[i].adminID + "\')\">修改</button>" +
						"<button type=\"button\" administrator=\"btn btn-danger ListOperButton  btn-xs \" data-toggle=\"modal\" data-target=\"#DeleteModal\"  onclick=\"del(\'" +
						obj[i].adminID + "\')\">删除</button>" +
						"</td></tr>";
					$("#administratorListBody").append(insert);
				} catch (err) {}
				s++;
			}
		}

		function edit(id) {
			console.log(id);
			for (i = 0; i < obj.length; i++) {
				if (obj[i].adminID == id) {
					$("#editAdminID").val(obj[i].adminID);
					$("#editAdminName").val(obj[i].adminName);
					$("#editAdminGender").val(obj[i].adminGender);
					$("#editAdminBirthDate").val(obj[i].adminBirthDate);
					$("#editAdminSocialID").val(obj[i].adminSocialID);
					$("#editAdminTel").val(obj[i].adminTel);
					$("#editAdminAddress").val(obj[i].adminAddress);
					$("#editAdminRight").val(obj[i].adminRight);
					break;
				}
			}
		}

		function del(id) {
			delAddminID = id;
		}

		function prePage() {
			if (nowPage != 1) {
				switchPage(nowPage - 1);
			}
		}

		function nextPage() {
			obj = JSON.parse(_data);
			if (nowPage != Math.floor(obj.length / 5 + 1)) {
				switchPage(nowPage + 1);
			}
		}

		function getCookie(cname) {
			var name = cname + "=";
			var ca = document.cookie.split(';');
			for (var i = 0; i < ca.length; i++) {
				var c = ca[i].trim();
				if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
			}
			return "";
		}

		function setCookie(name, value) {
			document.cookie = name + "=" + value + "; ";
		}
	</script>
</html>
