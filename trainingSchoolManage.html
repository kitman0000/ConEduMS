<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta charset="utf-8" />
		<link rel="stylesheet" href="css/bootstrap.css">
		<link rel="stylesheet" href="css/bootstrap.min.css">
		<link rel="stylesheet" href="css/webStyle.css">
		<link rel="stylesheet" href="css/bootstrap-datetimepicker.css">
		<link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css">

		<script src="js/System.js"></script>
		<script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
		<script src="js/bootstrap-datetimepicker.js"></script>
		<script src="js/bootstrap-datetimepicker.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/bootstrap-datetimepicker.zh-CN.js"></script>

	</head>
	<body>
		<div class="page">

			<!-- 标题 -->
			<nav class="navbar navbar-default" role="navigation" class="titlebar">
				<div class="container-fluid container">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#example-navbar-collapse">
							<span class="sr-only">切换导航</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="#">继续教育管理系统(管理端)</a>
					</div>
					<div class="collapse navbar-collapse" id="example-navbar-collapse">
						<ul class="nav navbar-nav" id="navbar">

						</ul>
					</div>
				</div>
			</nav>
			<!-- 标题结束 -->

			<!-- 内容开始 -->
			<div class="container">
				<!-- 导航开始 -->
				<div class="alert alert-info" role="alert">
					教学点基本信息
				</div>
				<!-- 导航结束 -->
				<!--教学班列表-->
				<div class="listAdd" align="right">
					<button id="addItem" data-toggle="modal" data-target="#addModal" class="btn btn-primary">添加</button>
				</div>
				<div class="bs-example" data-example-id="simple-table">
					<table class="table" id="ClassList">
						<thead class="row">
							<th class="col-sm-2 col-xs-2 ">
								教学点编号
							</th>
							<th class="col-sm-2 col-xs-2 ">
								名称
							</th>
							<th class="col-sm-2 col-xs-2 ">
								地址
							</th>
							<th class="col-sm-2 col-xs-2 ">
								对外咨询电话
							</th>
							<th class="col-sm-2 col-xs-2 ">
								备注信息
							</th>
						</thead>
						<tbody id="classListBody">

						</tbody>
					</table>
					<!-- 分页开始 -->
					<div style="width: 100%;" align="center">
						<ul class="pagination" id="pageDevider" style="margin-top: 10%;">

						</ul>
					</div>
					<!-- 分页结束 -->
				</div>
				<!--教学班列表结束-->

			</div>

			<!-- 内容结束 -->
		</div>

		<div class="container">
			<!-- 增加模态框 -->
			<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog" style="width: 50%;">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
								&times;
							</button>
							<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
								添加教学点
							</h4>
						</div>
						<table align="center">

							<tr>
								<td class="listItem" style="width: 100px;">
									<label for="addSchoolID" style="margin-right: 3px;">教学点编号:</label>
								</td>
								<td class="listItem" >
									<input type="text" class="form-control" id="addSchoolID" aria-describedby="basic-addon3">
								</td>

								<td class="listItem" style="width: 100px;">
									<label for="addSchoolName" style="margin-right: 3px;">名称:</label>
								</td>
								<td class="listItem">
									<input type="text" class="form-control" id="addSchoolName" aria-describedby="basic-addon3">
								</td>
							</tr>

							<tr>
								<td class="listItem">
									<label for="addSchoolAddress" style="margin-right: 3px;">地址:</label>
								</td>
								<td class="listItem">
									<input type="text" class="form-control" id="addSchoolAddress" aria-describedby="basic-addon3">
								</td>

								<td class="listItem">
									<label for="addSchoolTel" style="margin-right: 3px;">对外咨询电话:</label>
								</td>
								<td class="listItem">
									<input type="text" class="form-control" id="addSchoolTel" aria-describedby="basic-addon3">
								</td>
							</tr>
						
							<tr>
								<td class="listItem">
								    <label for="addSchoolRemark" style="margin-right: 1%;">备注:</label>
								</td>
								<td class="listItem">
									<input type="text" class="form-control" id="addSchoolRemark" aria-describedby="basic-addon3">
								</td>
								
							</tr>

						</table>
						
						
						<div class="modal-footer">

							<button type="button" class="btn btn-default" data-dismiss="modal">关闭
							</button>
							<button type="button" class="btn btn-primary" id="addTrainingSchool">
								确定
							</button>
						</div>
					</div>	
				</div><!-- /.modal-content -->
			</div><!-- /.modal -->
		</div>
		<!-- 结束增加模态框 -->

		<!-- 删除警告模态框 -->
		<div class="modal fade" id="DeleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog" style="width: 10%;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
							警告
						</h4>
					</div>
					<div class="modal-body" style="text-align: left;">
						确认要删除此教学点？
					</div>
					<div class="modal-footer" style=" 	width: 100%;display: table; text-align: center;">

						<button type="button" class="btn btn-default" data-dismiss="modal">关闭
						</button>
						<button type="button" id="confirmDelete" class="btn btn-danger" data-dismiss="modal">
							删除
						</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal -->
		</div>
		<!-- 结束删除警告模态框 -->


		<!-- 修改模态框 -->
		<div class="modal fade" id="ChangeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog" style="width: 50%;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
							修改教学点
						</h4>
					</div>
					<table align="center">
						<tr>
							<td class="listItem" style="width: 100px;">
								<label for="editSchoolID" style="margin-right: 3%;">教学点编号:</label>
							</td>
							<td class="listItem">
								<input type="text" class="form-control" id="editSchoolID" aria-describedby="basic-addon3" readonly="readonly">
							</td>
							<td class="listItem" style="width: 100px;">
								<label for="editSchoolName" style="margin-right: 4.3%;">名称:</label>
							</td>
							<td class="listItem">
								<input type="text" class="form-control" id="editSchoolName" aria-describedby="basic-addon3">
							</td>
						</tr>

						<tr>
							<td class="listItem">
								<label for="editSchoolAddress" style="margin-right: 3%;">地址:</label>
							</td>
							<td class="listItem">
								<input type="text" class="form-control" id="editSchoolAddress" aria-describedby="basic-addon3">
							</td>
							<td class="listItem">
								<label for="editSchoolTel" style="margin-right: 2.4%;">对外咨询电话:</label>
							</td>
							<td class="listItem">
								<input type="text" class="form-control" id="editSchoolTel" aria-describedby="basic-addon3">
							</td>
						</tr>
						
						<tr>
							<td class="listItem">
							<label for="editSchoolRemark" style="margin-right: 1%;">备注:</label>
							</td>
							<td class="listItem">
								<input type="text" class="form-control" id="editSchoolRemark" aria-describedby="basic-addon3">
							</td>
						</tr>	
						
			
					<div class="modal-footer">

						<button type="button" class="btn btn-default" data-dismiss="modal">关闭
						</button>
						<button type="button" class="btn btn-primary" id="editClass">
							提交更改
						</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal -->
		</div>
		<!-- 结束修改模态框 -->

		<!-- 警告信息模态框 -->
		<div class="modal fade" id="warningInfoModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog" style="width: 40%;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
							警告
						</h4>
					</div>
					<div class="modal-body" style="text-align: center;">
						<span id="warningInfo"></span>
					</div>
					<div class="modal-footer" style="width: 100%;display: table; text-align: center;">

						<button type="button" class="btn btn-default" data-dismiss="modal">确定
						</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal -->
		</div>
		<!-- 结束删除警告模态框 -->
		</div>
	</body>

	<script>
		var obj;

		$(function() {
			$("#navbar").html(getNavbar());
			$("#TrainingSchoolManage").addTrainingSchool("active");

			$.ajax({
				type: "POST",
				url: "TrainingSchoolManage.aspx/getAllTrainingSchools",
				datatype: "json",
				contentType: "application/json;charset=utf-8",
				data: {

				},
				success: function(data, textStatus) {
					showTrainingSchools(data.d);
				},
			});

			$("#addTrainingSchool").click(function() {
				//warningInfo
				if ($("#addSchoolID").val().length != 4) {
					$("#warningInfo").html("教学点编号（学院的ID为9999）为4位");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#addSchoolName").val().length != 30) {
					$("#warningInfo").html("教学点名称为30位");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#addSchoolAddress").val().length != 50) {
					$("#warningInfo").html("教学点地址为50位");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#addSchoolTel").val().length !=30) {
					$("#warningInfo").html("教学点对外咨询电话为30位");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#addSchoolRemark").val().length !=500) {
					$("#warningInfo").html("备注信息为500位");
					$("#warningInfoModal").modal("show");
					return;
				}

				for (i = 0; i < obj.length; i++) {
					if (obj[i].classID == $("#addClassID").val()) {
						$("#warningInfo").html("该班级ID已经被占用");
						$("#warningInfoModal").modal("show");
						return;
					}
				}

				$("#addModal").modal("hide");

				$.ajax({
					type: "POST",
					url: "TrainingSchoolManage.aspx/addTrainingSchool",
					datatype: "json",
					contentType: "application/json;charset=utf-8",
					data: "{" +
						"'schoolID':'" + $("#addSchoolID").val() + "'," +
						"'schoolName':'" + $("#addSchoolName").val() + "'," +
						"'schoolAddress':'" + $("#addSchoolAddress").val() + "'," +
						"'schoolTel':'" + $("#addSchoolTel").val() + "'," +
						"'schoolRemark':'" + $("#addSchoolRemark").val() + "'," +
						"}",
					success: function(data, textStatus) {
						setCookie("add", 1);
						location.reload();
					},
				});
			});

			$("#confirmDelete").click(function() {
				$.ajax({
					type: "POST",
					url: "TrainingSchoolManage.aspx/delTrainingSchool",
					datatype: "json",
					contentType: "application/json;charset=utf-8",
					data: "{" +
						"'TrainingSchoolID':'" + delTrainingSchoolID + "'" +
						"}",
					success: function(data, textStatus) {
						if (data.d == "success") {
							deleteSuccess();
						}
					},
				});
			});

			$("#editTrainingSchool").click(function() {

				if ($("#editSchoolID").val().length != 4) {
					$("#warningInfo").html("教学点编号（学院的ID为9999）为4位");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#editSchoolName").val().length != 30) {
					$("#warningInfo").html("教学点名称为30位");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#editSchoolAddress").val().length != 50) {
					$("#warningInfo").html("教学点地址为50位");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#editSchoolTel").val().length != 30) {
					$("#warningInfo").html("教学点对外咨询电话为30位");
					$("#warningInfoModal").modal("show");
					return;
				}

				if ($("#editSchoolRemark").val().length != 500) {
					$("#warningInfo").html("备注信息为500位");
					$("#warningInfoModal").modal("show");
					return;
				}


				$("#ChangeModal").modal("hide");

				$.ajax({
					type: "POST",
					url: "TrainingSchool.aspx/editTrainingSchool",
					datatype: "json",
					contentType: "application/json;charset=utf-8",
					data: "{" +
						"'schoolID':'" + $("#editSchoolID").val() + "'," +
						"'schoolName':'" + $("#editSchoolName").val() + "'," +
						"'schoolAddress':'" + $("#editSchoolAddress").val() + "'," +
						"'schoolTel':'" + $("#editSchoolTel").val() + "'," +
						"'schoolRemark':'" + $("#editSchoolRemark").val() + "'," +
						"}",
					success: function(data, textStatus) {
						if (data.d == "success") {
							editSuccess();
						}
					},
				});
			});
		});

		function showTrainingSchools(data) {
			obj = JSON.parse(data);
			_data = data;
			for (i = 0; i < obj.length && i < 5; i++) {
				try {
					insert = "<tr><td>" +
						obj[i].schoolID +
						"</td><td id=school" + obj[i].schoolID + ">" +
						obj[i].schoolID +
						"</td><td id=schoolName" + obj[i].schoolID + ">" +
						obj[i].schoolName +
						"</td><td id=schoolAddress" + obj[i].schoolID + ">" +
						obj[i].schoolAddress +
						"</td><td id=schoolTel" + obj[i].schoolID + ">" +
						obj[i].schoolTel +
						"</td><td id=schoolRemark" + obj[i].schoolID + ">" +
						obj[i].schoolRemark +
						"</td><td>" +
						"<button type=\"button\"  data-toggle=\"modal\" data-target=\"#ChangeModal\" class=\"btn btn-primary btn-xs ListOperButton\" onclick=\"edit(\'" +
						obj[i].classID + "\')\">修改</button>" +
						"<button type=\"button\" class=\"btn btn-danger ListOperButton  btn-xs \" data-toggle=\"modal\" data-target=\"#DeleteModal\"  onclick=\"del(\'" +
						obj[i].classID + "\')\">删除</button>" +
						"</td></tr>";
					$("#classListBody").append(insert);
				} catch (err) {}

			}
			$("#pageDevider").append("<li><a onclick=\"prePage()\" href=\"#\">&laquo;</a></li>")
			for (i = 1; i < obj.length / 5; i++) {
				$("#pageDevider").append("<li><a onclick=\"switchPage(" + i + ")\" href=\"#\">" + i + "</a></li>");
			}
			$("#pageDevider").append("<li><a onclick=\"switchPage(" + i + ")\" href=\"#\">" + i + "</a></li>");
			$("#pageDevider").append("<li><a onclick=\"nextPage()\" href=\"#\">&raquo;</a></li>")
			nowPage = 1;
			if (getCookie("add") == 1) {
				page = Math.floor(obj.length / 5);
				if (obj.length % 5 != 0) {
					page++;
				}
				switchPage(page);
				setCookie("add", 0);
			}
			if (getCookie("delete") != 0) {
				switchPage(getCookie("delete"));
				setCookie("delete", 0);
			}

			$('.form_date').datetimepicker({
				language: 'zh-CN',
				weekStart: 1,
				todayBtn: 1,
				autoclose: 1,
				todayHighlight: 1,
				startView: 2,
				minView: 2,
				forceParse: 0
			});
		}

		function deleteSuccess() {
			setCookie("delete", nowPage);
			location.reload();
		}

		function editSuccess() {
			for (i = 0; i < obj.length; i++) {
				if (obj[i].schoolID == $("#editSchoolID").val()) {
					obj[i].schoolName = $("#editSchoolName").val();
					obj[i].schoolAddress = $("#editSchoolAddress").val();
					obj[i].schoolTel = $("#editSchoolTel").val();
					obj[i].schoolRemark = $("#editSchoolRemark").val();
					switchPage(nowPage);
				}
			}
		}

		function switchPage(num) {
			nowPage = num;
			$("#classListBody").html("");
			//obj = JSON.parse(_data);
			s = 0;
			console.log(num);
			for (i = (num - 1) * 5; i < obj.length && s < 5; i++) {
				try {
					insert = "<tr><td>" +
						obj[i].schoolID +
						"</td><td id=school" + obj[i].schoolID + ">" +
						obj[i].schoolID +
						"</td><td id=schoolName" + obj[i].schoolID + ">" +
						obj[i].schoolName +
						"</td><td id=schoolAddress" + obj[i].schoollID + ">" +
						obj[i].schoolAddress +
						"</td><td id=schoolTel" + obj[i].schoolID + ">" +
						obj[i].schoolTel +
						"</td><td id=schoolRemark" + obj[i].schoolID + ">" +
						obj[i].schoolRemark +
						"</td><td>" +
						"<button type=\"button\"  data-toggle=\"modal\" data-target=\"#ChangeModal\" class=\"btn btn-primary btn-xs ListOperButton\" onclick=\"edit(\'" +
						obj[i].classID + "\')\">修改</button>" +
						"<button type=\"button\" class=\"btn btn-danger ListOperButton  btn-xs \" data-toggle=\"modal\" data-target=\"#DeleteModal\"  onclick=\"del(\'" +
						obj[i].classID + "\')\">删除</button>" +
						"</td></tr>";
					$("#classListBody").append(insert);
				} catch (err) {}
				s++;
			}
		}

		function edit(id) {
			console.log(id);
			for (i = 0; i < obj.length; i++) {
				if (obj[i].schoolID == id) {
					$("#editSchoolID").val(obj[i].schoolID);
					$("#editSchoolNameID").val(obj[i].schoolNameID);
					$("#editSchoolAddress").val(obj[i].schooladdress);
					$("#editSchoolTel").val(obj[i].schoolTel);
					$("#editSchoolRemark").val(obj[i].schoolRemark);
					break;
				}
			}
		}

		function del(id) {
			delschoolID = id;
		}

		function prePage() {
			if (nowPage != 1) {
				switchPage(nowPage - 1);
			}
		}

		function nextPage() {
			obj = JSON.parse(_data);
			if (nowPage != Math.floor(obj.length / 5 + 1)) {
				switchPage(nowPage + 1);
			}
		}

		function getCookie(cname) {
			var name = cname + "=";
			var ca = document.cookie.split(';');
			for (var i = 0; i < ca.length; i++) {
				var c = ca[i].trim();
				if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
			}
			return "";
		}

		function setCookie(name, value) {
			document.cookie = name + "=" + value + "; ";
		}
	</script>
</html>
