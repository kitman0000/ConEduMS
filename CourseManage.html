<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
	<meta charset="utf-8" />  
	<link rel="stylesheet" href="css/bootstrap.min.css">  
	<link rel="stylesheet" href="css/webStyle.css">  
	<link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css">
	
	<script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
	<script src="js/bootstrap-datetimepicker.js"></script>
	<script src="js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/bootstrap-datetimepicker.zh-CN.js"></script>
	
</head>
<body>
	<div class="page">
		
    	<!-- 标题 -->
        <nav class="navbar navbar-default" role="navigation" class="titlebar">
            <div class="container-fluid container" > 
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                        data-target="#example-navbar-collapse">
                    <span class="sr-only">切换导航</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">继续教育管理系统(管理端)</a>
            </div>
            <div class="collapse navbar-collapse" id="example-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li role="presentation"><a href="#">专业管理</a></li>
   					<li role="presentation"><a href="#">教学点管理</a></li>
					<li role="presentation"  class="active"><a href="#">课程管理</a></li>
					<li role="presentation"><a href="#">教师管理</a></li>
					<li role="presentation"><a href="#">教学班管理</a></li>
					<li role="presentation"><a href="#">学生管理</a></li>
					<li role="presentation"><a href="#">成绩管理</a></li>
					<li role="presentation"><a href="#">学生查询</a></li>
				</ul>  
            </div>
            </div>
        </nav>
        <!-- 标题结束 -->
						
		<!-- 内容开始 -->
		<div class="container">
			<!-- 导航开始 -->
			<div class="alert alert-info" role="alert">
				课程管理
			</div>
			<!-- 导航结束 -->
			<!--课程列表-->
			<div class="listAdd" align="right">
				<button id="addItem"  data-toggle="modal" data-target="#addModal" class="btn btn-primary">添加</button>
			</div>
			<div class="bs-example" data-example-id="simple-table">
				<table class="table" id="ClassList">
					<thead class="row">
						<th class="col-sm-2 col-xs-2 ">
							课程编号
						</th>
						<th class="col-sm-2 col-xs-2 ">
							课程名称
						</th>
						<th class="col-sm-2 col-xs-2 ">
							备注信息
						</th>
					
						<th class="col-sm-2 col-xs-2 ">
							
						</th>
					</thead>
					<tbody id="CourseListBody">
						
					</tbody>
				</table>
				<!-- 分页开始 -->
				<div style="width: 100%;" align="center">
					<ul class="pagination" id="pageDevider" style="margin-top: 10%;">
						
					</ul>
				</div>
				<!-- 分页结束 -->
			</div>
			<!--课程列表结束-->

		</div>
		
		<!-- 内容结束 -->
	</div>
	
	<!-- 增加模态框 -->
	<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="width: 50%;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
						添加课程
					</h4>
				</div>
				<div class="modal-body" style="text-align: left; padding-left: 25%;" align="center">
					<div class="form-group form-inline">
						<label for="basic-url" style="margin-right: 1%;">课程ID:</label>
						<div class="input-group">
							<input type="text" class="form-control" id="addCourseID" aria-describedby="basic-addon3">
						</div>
						<label for="basic-url" style="margin-right: 1%;">名称:</label>
						<div class="input-group">
							<input type="text" class="form-control" id="addCourseName" aria-describedby="basic-addon3">
						</div>
					</div>
					
					<div class="form-group form-inline">
						<label for="basic-url" style="margin-right: 3%;">备注:</label>
					<div class="input-group">
						<input type="text" class="form-control" id="addCourseRemark" aria-describedby="basic-addon3">
					</div>
					</div>
					
				</div>
				<div class="modal-footer">
								
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭
					</button>
					<button type="button" class="btn btn-primary" id="addCourse">
						确定
					</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal -->
	</div>
	<!-- 结束增加模态框 -->
	
	<!-- 删除警告模态框 -->
	<div class="modal fade" id="DeleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="width: 10%;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
						警告
					</h4>
				</div>
				<div class="modal-body" style="text-align: left;">
					确认要删除此课程？
				</div>
				<div class="modal-footer" style=" 	width: 100%;display: table; text-align: center;">
					
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭
					</button>
					<button type="button" id="confirmDelete" class="btn btn-danger" data-dismiss="modal">
						删除
					</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal -->
	</div>
	<!-- 结束删除警告模态框 -->
	
			
	<!-- 修改模态框 -->
	<div class="modal fade" id="ChangeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="width: 50%;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
						修改班级
					</h4>
				</div>
				<div class="modal-body" style="text-align: left;padding-left: 25%;">

					<div class="form-group form-inline">
							<label for="basic-url" style="margin-right: 1%;">课程ID:</label>
							<div class="input-group">
								<input type="text" class="form-control" id="addCourseID" aria-describedby="basic-addon3">
							</div>
							<label for="basic-url" style="margin-right: 1%;">名称:</label>
							<div class="input-group">
								<input type="text" class="form-control" id="addCourseName" aria-describedby="basic-addon3">
							</div>
						</div>
						
						<div class="form-group form-inline">
							<label for="basic-url" style="margin-right: 3.8%;">备注:</label>
						<div class="input-group">
							<input type="text" class="form-control" id="addCourseRemark" aria-describedby="basic-addon3">
						</div>
						</div>
					
				
				</div>
				<div class="modal-footer">
					
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭
					</button>
					<button type="button" class="btn btn-primary" id="editCourse">
						提交更改
					</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal -->
	</div>
	<!-- 结束修改模态框 -->
	
	<!-- 警告信息模态框 -->
	<div class="modal fade" id="warningInfoModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="width: 40%;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel" style="text-align: left;">
						警告
					</h4>
				</div>
				<div class="modal-body" style="text-align: center;">
					<span id="warningInfo"></span>
				</div>
				<div class="modal-footer" style="width: 100%;display: table; text-align: center;">
					
					<button type="button" class="btn btn-default" data-dismiss="modal">确定
					</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal -->
	</div>
	<!-- 结束删除警告模态框 -->
</body>

<script>
var obj;

$(function(){
	$.ajax({
		type: "POST",
		url: "ClassManage.aspx/getAllClasses",
		datatype: "json",
		contentType: "application/json;charset=utf-8",
		data:
		{
			
		},
		success:
			function (data, textStatus) {
				showClasses(data.d);
			},
	});
	
	$("#addCourse").click(function(){
		//warningInfo
		if($("#addCourseID").val().length !=4)
		{
			$("#warningInfo").html("课程编号为4位");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		if($("#addCourseName").val().length <=30)
		{
			$("#warningInfo").html("课程信息小于等于30位");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		if($("#addCourseRemark").val().length <=500)
		{
			$("#warningInfo").html("备注小于等于500字");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		
		for(i = 0;i<obj.length;i++)
		{
			if(obj[i].classID == $("#addCourseID").val())
			{
				$("#warningInfo").html("该课程ID已经被占用");
				$("#warningInfoModal").modal("show");
				return;
			}
		}

		$("#addModal").modal("hide");
		
		$.ajax({
			type: "POST",
			url: "ClassManage.aspx/addClass",
			datatype: "json",
			contentType: "application/json;charset=utf-8",
			data:
				"{"+
				"'courseID':'" + $("#addCourseID").val()+"',"+
				"'courseName':'" + $("#addCourseName").val()+"',"+
				"'courseRemark':'" + $("#addCourseRemark").val()+"',"+
				+"}"
			,
			success:
				function (data, textStatus) {
					setCookie("add",1);
					location.reload();
				},
		});
	});
	
	$("#confirmDelete").click(function(){
		$.ajax({
			type: "POST",
			url: "ClassManage.aspx/delClass",
			datatype: "json",
			contentType: "application/json;charset=utf-8",
			data:
				"{"+
				"'CourseID':'" + delCourseID +"'"+
				"}"
			,
			success:
				function (data, textStatus) {
					if(data.d == "success")
					{
						deleteSuccess();
					}
				},
		});
	});
	
	$("#editCourse").click(function(){
		
		if($("#editCourseID").val().length !=4)
		{
			$("#warningInfo").html("课程编号位4位");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		if($("#editCourseName").val().length <=30)
		{
			$("#warningInfo").html("课程名称小于等于30位");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		if($("#editCourseRemark").val().length <=500)
		{
			$("#warningInfo").html("备注信息小于等于500字");
			$("#warningInfoModal").modal("show");
			return;
		}
		
		
		

		$("#ChangeModal").modal("hide");
		
		$.ajax({
			type: "POST",
			url: "ClassManage.aspx/editClass",
			datatype: "json",
			contentType: "application/json;charset=utf-8",
			data:
				"{"+
				"'courseID':'" + $("#editClassID").val()+"',"+
				"'courseNameID':'" + $("#editMajorID").val()+"',"+
				"'courseRemarkID':'" + $("#editSchoolID").val()+"',"+
				+"}"
			,
			success:
				function (data, textStatus) {
					if(data.d == "success")
					{
						editSuccess();
					}
				},
		});
	});
});
	
function showClasses(data)
{
	obj = JSON.parse(data);
	_data = data;
	for(i=0;i<obj.length&&i<5;i++)
	{
		try{
			insert = "<tr><th>"+
			obj[i].courseID+
			"</th><th>"+
			obj[i].courseName+
			"</th><th>"+
			obj[i].courseRemark+
			"</th><th>"+
			"<button type=\"button\"  data-toggle=\"modal\" data-target=\"#ChangeModal\" class=\"btn btn-primary btn-xs ClassListButton\" onclick=\"edit(\'" + obj[i].classID + "\')\">修改</button>"+
			"<button type=\"button\" class=\"btn btn-danger ClassListButton  btn-xs \" data-toggle=\"modal\" data-target=\"#DeleteModal\"  onclick=\"del(\'" + obj[i].classID + "\')\">删除</button>"+
			"</th></tr>";
			$("#courseListBody").append(insert);
		}
		catch(err){}
		
	}
	$("#pageDevider").append("<li><a onclick=\"prePage()\" href=\"#\">&laquo;</a></li>")
	for(i=1;i<obj.length/5;i++)
	{
		$("#pageDevider").append("<li><a onclick=\"switchPage("	+i+")\" href=\"#\">"+i+"</a></li>");
	}
	$("#pageDevider").append("<li><a onclick=\"switchPage("+i+")\" href=\"#\">"+i+"</a></li>");
	$("#pageDevider").append("<li><a onclick=\"nextPage()\" href=\"#\">&raquo;</a></li>")
	nowPage = 1;
	if(getCookie("add")==1)
	{
		page = Math.floor(obj.length / 5);
		if(obj.length % 5 != 0)
		{
			page++;
		}
		switchPage(page);
		setCookie("add",0);
	}
	if(getCookie("delete")!=0)
	{
		switchPage(getCookie("delete"));
		setCookie("delete",0);
	}
	
	$('.form_date').datetimepicker({
		language:  'zh-CN',
		weekStart: 1,
		todayBtn:  1,
		autoclose: 1,
		todayHighlight: 1,
		startView: 2,
		minView: 2,
		forceParse: 0
	});
}



function deleteSuccess()
{
	setCookie("delete",nowPage);
	location.reload();
}

function editSuccess()
{
	for(i = 0;i<obj.length;i++)
	{
		if(obj[i].courseID == $("#editCourseID").val())
		{
			obj[i].courseName = $("#editCourseName").val();
			obj[i].courseRemark = $("#editCourseRemark").val();
			switchPage(nowPage);
		}
	}
}

function switchPage(num)
{
	nowPage = num;
	$("#courseListBody").html("");
	//obj = JSON.parse(_data);
	s=0;
	console.log(num);
	for(i=(num-1)*5;i<obj.length&&s<5;i++)
	{
		try{
			insert = "<tr><th>"+
			obj[i].courseID+
			"</th><th>"+
			obj[i].courseName+
			"</th><th>"+
			obj[i].courseRemark+
			"</th><th>"+
			"<button type=\"button\"  data-toggle=\"modal\" data-target=\"#ChangeModal\" class=\"btn btn-primary btn-xs ClassListButton\" onclick=\"edit(\'" + obj[i].classID + "\')\">修改</button>"+
			"<button type=\"button\" class=\"btn btn-danger ClassListButton  btn-xs \" data-toggle=\"modal\" data-target=\"#DeleteModal\"  onclick=\"del(\'" + obj[i].classID + "\')\">删除</button>"+
			"</th></tr>";
			$("#courseListBody").append(insert);
		}
		catch(err){}
		s++;
	}
}

function edit(id)
{
	console.log(id);
	for(i = 0;i<obj.length;i++)
	{
		if(obj[i].courseID == id)
		{
			$("#editCourseID").val(obj[i].classID);
			$("#editCourseName").val(obj[i].majorID);
			$("#editCourseRemark").val(obj[i].schoolID);
			break;
		}
	}
}

function del(id)
{
	delCourseID = id;
}

function prePage()
{
	if(nowPage!=1)
	{
		switchPage(nowPage - 1);
	}
}

function nextPage()
{
	obj = JSON.parse(_data);
	if(nowPage!=obj.length/5 + 1)
	{
		switchPage(nowPage + 1);
	}
}

function getCookie(cname)
{
  var name = cname + "=";
  var ca = document.cookie.split(';');
  for(var i=0; i<ca.length; i++) 
  {
    var c = ca[i].trim();
    if (c.indexOf(name)==0) return c.substring(name.length,c.length);
  }
  return "";
}

function setCookie(name,value)
{
     document.cookie = name + "=" + value + "; ";
} 
</script>
</html>
